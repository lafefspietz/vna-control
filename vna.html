<!doctype html>
<html lang="en">
<head>
   <meta charset="utf-8">
   <!--

-->
<link href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAA/wAAAAD/AAAAAP8A/wD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAACIAADMwAEQAIgAAAwAARAAAIAADAAQAAAACAAAAQAAAAAAAAAAAAAAQAAAAAAABAREQAAAAAREQEAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAQAAwAgAAAAQAADAAIAAEQAAAMAACIARAAAMzAAIgAAAAADAAAAD/fwAAnjkAAJ95AADvdwAA9+8AAP9/AAC/fQAAD3AAAL99AAD8HwAA//8AAPdvAADvdwAAn3kAAJ45AAD/fwAA" rel="icon" type="image/x-icon">

   <title>Vector Network Analyzer</title>    
   <script src="https://cdn.jsdelivr.net/npm/p5@1.7.0/lib/p5.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
   <script>
    MathJax.Hub.Config({
        tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true,
        processClass: "mathjax",
        ignoreClass: "no-mathjax"
        }
    });//			MathJax.Hub.Typeset();//tell Mathjax to update the math
</script>
</head>
<body>
<style>

#scroll{
    position:absolute;
    left:5px;
    top:5px;
    border:solid;
    border-width:2px;
    border-radius:5px;
    padding:1em 1em 1em 1em;
    overflow:scroll;
    background-color:white;
}
table{
    font-size:2em;
}
input{
    font-size:1em;
    width:6em;
}

body{
    font-family:Arial;
    background-color:#9f8767;
    overflow:hidden;
}
input{
    color:#00ff00;
    background-color:black;
    font-family:courier;
    border-color:#0CCDDF;
}
h1{
    text-align:center;
}
.button{
    border:solid;
    cursor:pointer;
    text-align:center;
    border-width:10px;
    
}
.button:hover{
    background-color:#0CCDDF40;
    border-color:green;
}
.button:active{
    background-color:#0CCDDFa0;
}


a{
/*    color:#ff2cb4;*/
    color:blue;
}
.datafilelink{
    display:block;
    color:blue;
}
.datalink{
    color:blue;
    border:solid;
    border-color:blue;
    text-align:center;
    padding:5px 5px 5px 5px;
    border-radius:5px;
    margin-top:5px;
    margin-bottom:5px;
    cursor:pointer;
}
.datalink:hover{
    background-color:#0000ff60;
}
.datalink:active{
    background-color:#ffffff60;
}
main{
    position:absolute;
    right:5px;
    top:5px;
    border:solid;
    cursor:pointer;
    background-color:white;
    border-radius:5px;
}
</style>
<div id = "scroll">
    <a href= "index.html">HOME</a>
    <h1>VNA</h1>
    <h1>Vector Network Analyzer</h1>
    <p style = "font-size:3em">
        <span style = "color:red">$- S_{11}$</span>
        <span style = "color:green">$- S_{22}$</span>
        <span style = "color:blue">$- S_{12}$</span>
        <span style = "color:purple">$- S_{21}$</span>

    </p>
    <H1>Display Controls:</H1>
    <table>
        <tr>
            <td id = "s11" class = "button" style ="color:red">$S_{11}$</td>
            <td id = "s12" class = "button" style ="color:blue">$S_{12}$</td>
        </tr>
        <tr>
            <td id = "s21" class = "button" style ="color:purple">$S_{21}$</td>
            <td id = "s22" class = "button" style ="color:green">$S_{22}$</td>
        </tr>

        <tr>
            <td>
                Display Mode:
            </td>
            <td id = "displaymode" class = "button">DB</td>
        </tr>
        <tr>
            <td>dB min:</td>
            <td>
                <input id = "dbmin">
            </td>
        </tr>
        <tr>
            <td>dB max:</td>
            <td>
                <input id = "dbmax">
            </td>
        </tr>
        <tr style="display:none">
            <td>Picoseconds Delay:</td>
            <td>
                <input id = "picoseconds">
            </td>
        </tr>
    </table>
    <h1>VNA State Settings:</h1>
    <table>
        <tr>
            <td>Number of Points:</td>
            <td>
                <input id = "numpoints">
            </td>
        </tr>
        <tr>
            <td>Fstart [GHz]:</td>
            <td>
                <input id = "start">
            </td>
        </tr>
        <tr>
            <td>Fstop [GHz]:</td>
            <td>
                <input id = "stop">
            </td>
        </tr>
        <tr>
            <td>IFBW [Hz]:</td>
            <td>
                <input id = "ifbw">
            </td>
        </tr>
        <tr>
            <td>POWER:</td>
            <td class = "button" id = "powerbutton">
                HIGH/LOW
            </td>
        </tr>
    </table>
    <h1>Cryo Switch State</h1>
    <table>
        <tr>
            <td id ="shortbutton" class = "button">ECAL SHORT</td>
            <td id ="path1button" class = "button">PATH 1</td>
        </tr>
        <tr>
            <td  id ="openbutton" class = "button">ECAL OPEN</td>
            <td id ="path2button" class = "button">PATH 2</td>
        </tr>
        <tr>
            <td id ="loadbutton" class = "button">ECAL LOAD</td>
            <td id ="path3button" class = "button">PATH 3</td>
        </tr>
        <tr>
            <td></td>
            <td id ="path4button" class = "button">PATH 4</td>
        </tr>
        <tr>
            <td></td>
            <td id ="path5button" class = "button">PATH 5</td>
        </tr>
        <tr>
            <td ></td>
            <td id ="path6button" class = "button">PATH 6</td>
        </tr>

    </table>
    <div id = "savebutton" class = "button">SAVE TOUCHSTONE FILE</div>
    <div id = "savepngbutton" class = "button">SAVE PNG IMAGE FILE</div>
</div>
<script>

document.getElementById("savepngbutton").onclick = function(){
    png64 = document.getElementById("defaultCanvas0").toDataURL("image/png");
    newfilename =  "trace" + nowjson.datetime.replaceAll(":","_") + ".png";
    var httpc = new XMLHttpRequest();
    var url = "save-png.php";        
    httpc.open("POST", url, true);
    httpc.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
//    
    httpc.send("data="+encodeURIComponent(png64.substring(22))+"&filename=" + newfilename);//send text to filesaver.php
     //location.reload(); 
     
}

document.getElementById("savebutton").onclick = function(){
    var httpcs = new XMLHttpRequest();
    httpcs.onreadystatechange = function(){
        if (this.readyState == 4 && this.status == 200) {
            rawtrace = this.responseText;
            rawtrace = "!ifbw:" + vnacontrol.ifbw.toString() + "\n" + rawtrace;
//            rawtrace = "!temperature:300 K\n" + rawtrace;
            
            rawtrace = "!datetime:" + nowjson.datetime + "\n" + rawtrace;
            rawtrace = "!power:" + vnacontrol.power + "\n" + rawtrace;
            rawtrace = "!switchstate:" + switchstate.state + "\n" + rawtrace;
            rawtrace = "!url:https://github.com/lafefspietz/vna-control\n" + rawtrace;

        
            newfilename =  "trace" + nowjson.datetime.replaceAll(":","_") + ".s2p";
            console.log(newfilename);
            var url = "save-file.php";        
            var httpc = new XMLHttpRequest();
            httpc.open("POST", url, true);
            httpc.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            httpc.send("data="+encodeURIComponent(rawtrace)+"&filename=" +newfilename);//send text to filesaver.php            
            
        }
    };
    httpcs.open("GET", "load-file.php?filename=trace.s2p", true);
    httpcs.send();

}

document.getElementById("s11").onclick = function(){
    displaystate.show[0] = !displaystate.show[0];
    savedisplaystate();
}
document.getElementById("s12").onclick = function(){
    displaystate.show[1] = !displaystate.show[1];
    savedisplaystate();
}
document.getElementById("s21").onclick = function(){
    displaystate.show[2] = !displaystate.show[2];
    savedisplaystate();
}
document.getElementById("s22").onclick = function(){
    displaystate.show[3] = !displaystate.show[3];
    savedisplaystate();
}


document.getElementById("dbmin").onchange = function(){
    displaystate.dbmin = parseFloat(this.value);
    savedisplaystate();
}
document.getElementById("dbmax").onchange = function(){
    displaystate.dbmax = parseFloat(this.value);
    savedisplaystate();
}

document.getElementById("picoseconds").onchange = function(){
    displaystate.picoseconds = parseFloat(this.value);
    savedisplaystate();
}


document.getElementById("displaymode").onclick = function(){
    if(this.innerHTML == "Power [dB]"){
        displaystate.mode = "Phase [deg]";
        this.innerHTML = displaystate.mode;
        savedisplaystate();
    }
    else{
        displaystate.mode = "Power [dB]";
        this.innerHTML = displaystate.mode;
        savedisplaystate();
    }
}

if(innerWidth > innerHeight){
    squaresize = innerHeight - 20;
    document.getElementById("scroll").style.width = (innerWidth - squaresize - 60).toString() + "px";
    
    document.getElementById("scroll").style.height = (innerHeight - 47).toString() + "px";
    
}
else{
    squaresize = innerHeight - 10;
    document.getElementById("scroll").style.width = (innerWidth - 10).toString() + "px";
    document.getElementById("scroll").style.height = (innerHeight - squaresize -  15).toString() + "px";    
}

displaystate = {};
displaystate.dbmin = -120;
displaystate.dbmax = 10;
displaystate.picoseconds = 0;
displaystate.mode = "Power [dB]";//Power [dB] or Phase [deg]
displaystate.show = [true,true,true,true];

var httpcd = new XMLHttpRequest();
httpcd.onreadystatechange = function(){
    if (this.readyState == 4 && this.status == 200) {
        displaystate = JSON.parse(this.responseText);
        document.getElementById("dbmin").value = displaystate.dbmin.toString();
        document.getElementById("dbmax").value = displaystate.dbmax.toString();
        document.getElementById("picoseconds").value = displaystate.picoseconds.toString();
        document.getElementById("displaymode").innerHTML = displaystate.mode;

    }
};
httpcd.open("GET", "load-file.php?filename=display-state.json", true);
httpcd.send();

trace = {};
filename = "trace.json";
vnacontrol = {};
vnacontrol.numpoints = 400;//integer number of points
vnacontrol.ifbw = 1000;//IF Bandwidth in Hz
vnacontrol.start = 1e9;//sweep start frequency in Hz
vnacontrol.stop = 10e9;//sweep stop frequency in Hz
vnacontrol.power = "HIGH";//HIGH or LOW

phasemode = false;

var httpc = new XMLHttpRequest();
httpc.onreadystatechange = function(){
    if (this.readyState == 4 && this.status == 200) {
        vnacontrol = JSON.parse(this.responseText);
        document.getElementById("numpoints").value = vnacontrol.numpoints.toString();
        document.getElementById("ifbw").value = vnacontrol.ifbw.toString();
        document.getElementById("start").value = (vnacontrol.start/1e9).toString();
        document.getElementById("stop").value = (vnacontrol.stop/1e9).toString();
        document.getElementById("powerbutton").innerHTML = vnacontrol.power;
    }
};
httpc.open("GET", "load-file.php?filename=vna-control.json", true);
httpc.send();

var httpcs = new XMLHttpRequest();
httpcs.onreadystatechange = function(){
    if (this.readyState == 4 && this.status == 200) {
        switchstate = JSON.parse(this.responseText);
        setbuttons();
    }
};
httpcs.open("GET", "load-file.php?filename=switch-state.json", true);
httpcs.send();

function setbuttons(){
    if(switchstate.state == "s"){
        document.getElementById("shortbutton").style.backgroundColor = "green";
        document.getElementById("openbutton").style.backgroundColor = "white";
        document.getElementById("loadbutton").style.backgroundColor = "white";
        document.getElementById("path1button").style.backgroundColor = "white";
        document.getElementById("path2button").style.backgroundColor = "white";
        document.getElementById("path3button").style.backgroundColor = "white";
        document.getElementById("path4button").style.backgroundColor = "white";
        document.getElementById("path5button").style.backgroundColor = "white";
        document.getElementById("path6button").style.backgroundColor = "white";            
    }
    if(switchstate.state == "o"){
        document.getElementById("shortbutton").style.backgroundColor = "white";
        document.getElementById("openbutton").style.backgroundColor = "green";
        document.getElementById("loadbutton").style.backgroundColor = "white";
        document.getElementById("path1button").style.backgroundColor = "white";
        document.getElementById("path2button").style.backgroundColor = "white";
        document.getElementById("path3button").style.backgroundColor = "white";
        document.getElementById("path4button").style.backgroundColor = "white";
        document.getElementById("path5button").style.backgroundColor = "white";
        document.getElementById("path6button").style.backgroundColor = "white";            
    }       
    if(switchstate.state == "l"){
        document.getElementById("shortbutton").style.backgroundColor = "white";
        document.getElementById("openbutton").style.backgroundColor = "white";
        document.getElementById("loadbutton").style.backgroundColor = "green";
        document.getElementById("path1button").style.backgroundColor = "white";
        document.getElementById("path2button").style.backgroundColor = "white";
        document.getElementById("path3button").style.backgroundColor = "white";
        document.getElementById("path4button").style.backgroundColor = "white";
        document.getElementById("path5button").style.backgroundColor = "white";
        document.getElementById("path6button").style.backgroundColor = "white";            
    }       
    if(switchstate.state == "1"){
        document.getElementById("shortbutton").style.backgroundColor = "white";
        document.getElementById("openbutton").style.backgroundColor = "white";
        document.getElementById("loadbutton").style.backgroundColor = "white";
        document.getElementById("path1button").style.backgroundColor = "green";
        document.getElementById("path2button").style.backgroundColor = "white";
        document.getElementById("path3button").style.backgroundColor = "white";
        document.getElementById("path4button").style.backgroundColor = "white";
        document.getElementById("path5button").style.backgroundColor = "white";
        document.getElementById("path6button").style.backgroundColor = "white";            
    }       
    if(switchstate.state == "2"){
        document.getElementById("shortbutton").style.backgroundColor = "white";
        document.getElementById("openbutton").style.backgroundColor = "white";
        document.getElementById("loadbutton").style.backgroundColor = "white";
        document.getElementById("path1button").style.backgroundColor = "white";
        document.getElementById("path2button").style.backgroundColor = "green";
        document.getElementById("path3button").style.backgroundColor = "white";
        document.getElementById("path4button").style.backgroundColor = "white";
        document.getElementById("path5button").style.backgroundColor = "white";
        document.getElementById("path6button").style.backgroundColor = "white";            
    }       
    if(switchstate.state == "3"){
        document.getElementById("shortbutton").style.backgroundColor = "white";
        document.getElementById("openbutton").style.backgroundColor = "white";
        document.getElementById("loadbutton").style.backgroundColor = "white";
        document.getElementById("path1button").style.backgroundColor = "white";
        document.getElementById("path2button").style.backgroundColor = "white";
        document.getElementById("path3button").style.backgroundColor = "green";
        document.getElementById("path4button").style.backgroundColor = "white";
        document.getElementById("path5button").style.backgroundColor = "white";
        document.getElementById("path6button").style.backgroundColor = "white";            
    }       
    if(switchstate.state == "4"){
        document.getElementById("shortbutton").style.backgroundColor = "white";
        document.getElementById("openbutton").style.backgroundColor = "white";
        document.getElementById("loadbutton").style.backgroundColor = "white";
        document.getElementById("path1button").style.backgroundColor = "white";
        document.getElementById("path2button").style.backgroundColor = "white";
        document.getElementById("path3button").style.backgroundColor = "white";
        document.getElementById("path4button").style.backgroundColor = "green";
        document.getElementById("path5button").style.backgroundColor = "white";
        document.getElementById("path6button").style.backgroundColor = "white";            
    }       
    if(switchstate.state == "5"){
        document.getElementById("shortbutton").style.backgroundColor = "white";
        document.getElementById("openbutton").style.backgroundColor = "white";
        document.getElementById("loadbutton").style.backgroundColor = "white";
        document.getElementById("path1button").style.backgroundColor = "white";
        document.getElementById("path2button").style.backgroundColor = "white";
        document.getElementById("path3button").style.backgroundColor = "white";
        document.getElementById("path4button").style.backgroundColor = "white";
        document.getElementById("path5button").style.backgroundColor = "green";
        document.getElementById("path6button").style.backgroundColor = "white";            
    }       
    if(switchstate.state == "6"){
        document.getElementById("shortbutton").style.backgroundColor = "white";
        document.getElementById("openbutton").style.backgroundColor = "white";
        document.getElementById("loadbutton").style.backgroundColor = "white";
        document.getElementById("path1button").style.backgroundColor = "white";
        document.getElementById("path2button").style.backgroundColor = "white";
        document.getElementById("path3button").style.backgroundColor = "white";
        document.getElementById("path4button").style.backgroundColor = "white";
        document.getElementById("path5button").style.backgroundColor = "white";
        document.getElementById("path6button").style.backgroundColor = "green";            
    }       
}

document.getElementById("shortbutton").onclick = function(){
    switchstate.state = "s";
    setbuttons();
    saveswitchstate();
}
document.getElementById("openbutton").onclick = function(){
    switchstate.state = "o";
    setbuttons();
    saveswitchstate();
}
document.getElementById("loadbutton").onclick = function(){
    switchstate.state = "l";
    setbuttons();
    saveswitchstate();
}
document.getElementById("path1button").onclick = function(){
    switchstate.state = "1";
    setbuttons();
    saveswitchstate();
}
document.getElementById("path2button").onclick = function(){
    switchstate.state = "2";
    setbuttons();
    saveswitchstate();
}
document.getElementById("path3button").onclick = function(){
    switchstate.state = "3";
    setbuttons();
    saveswitchstate();
}
document.getElementById("path4button").onclick = function(){
    switchstate.state = "4";
    setbuttons();
    saveswitchstate();
}
document.getElementById("path5button").onclick = function(){
    switchstate.state = "5";
    setbuttons();
    saveswitchstate();
}
document.getElementById("path6button").onclick = function(){
    switchstate.state = "6";
    setbuttons();
    saveswitchstate();
}


document.getElementById("numpoints").onchange = function(){
    vnacontrol.numpoints = parseInt(this.value);
    savevnacontroljson();
}
document.getElementById("ifbw").onchange = function(){
    vnacontrol.ifbw = parseFloat(this.value);
    savevnacontroljson();
}
document.getElementById("start").onchange = function(){
    vnacontrol.start = parseFloat(this.value*1e9);
    savevnacontroljson();
}
document.getElementById("stop").onchange = function(){
    vnacontrol.stop = parseFloat(this.value*1e9);
    savevnacontroljson();
}
document.getElementById("powerbutton").onclick = function(){
    if(this.innerHTML == "HIGH"){
        this.innerHTML = "LOW";
    }
    else{
        this.innerHTML = "HIGH";
    }
    
    vnacontrol.power = this.innerHTML;
    savevnacontroljson();
}





function setup() {
    createCanvas(squaresize,squaresize);    
    strokeWeight(1);  
}

traceindex=0;
oldtraceindex= 0;
function draw(){
    
    var httpc = new XMLHttpRequest();
    httpc.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            nowjson = JSON.parse(this.responseText);
            traceindex = nowjson.traceindex;
            if(traceindex != oldtraceindex){ //only load trace if new trace has been taken
                var httpct = new XMLHttpRequest();
                httpct.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        trace = JSON.parse(this.responseText);
                        loadtrace();
                    }
                };
                httpct.open("GET", "load-file.php?filename=trace.json", true);
                httpct.send();
                
            }
        }
    };
    httpc.open("GET", "load-file.php?filename=now.json", true);
    httpc.send();
    traceindexold = traceindex;
    
}

function loadtrace(){
    clear();
    background(255);
    noFill();
    strokeWeight(1);
    stroke(0);

    if(displaystate.mode == "Power [dB]"){

        for(var dbvalue = displaystate.dbmin;dbvalue < displaystate.dbmax;dbvalue += 10){
            line(0,map(dbvalue,displaystate.dbmin,displaystate.dbmax,height,0),width,map(dbvalue,displaystate.dbmin,displaystate.dbmax,height,0));
        }
        for(var fghz = trace.f[0]/1e9;fghz < trace.f[trace.f.length - 1]/1e9;fghz += 1){
            line(map(fghz,trace.f[0]/1e9,trace.f[trace.f.length - 1]/1e9,0,width),0,map(fghz,trace.f[0]/1e9,trace.f[trace.f.length - 1]/1e9,0,width),height);
        }
        fill(0);
        textSize(25); 
        for(var dbvalue = displaystate.dbmin;dbvalue < displaystate.dbmax;dbvalue += 10){
            text(Math.round(dbvalue).toString() + " dB",10,map(dbvalue,displaystate.dbmin,displaystate.dbmax,height,0) - 5);
        }
    
        for(var fghz = trace.f[0]/1e9;fghz < trace.f[trace.f.length - 1]/1e9;fghz += 1){
            if(fghz > 0.5){
                text(Math.round(fghz).toString() + " GHz",5+map(fghz,trace.f[0]/1e9,trace.f[trace.f.length - 1]/1e9,0,width),30);            
            }
    
        }
        
        noFill();
        strokeWeight(5);
        
        if(displaystate.show[0]){
            stroke("red");
            beginShape();    
            for(var index = 0;index < trace.f.length;index++){
                vertex(map(trace.f[index],0,trace.f[trace.f.length-1],0,width),map(trace.s11db[index],displaystate.dbmin,displaystate.dbmax,height,0));
            }
            endShape();
        }
        if(displaystate.show[3]){
            stroke("green");
            beginShape();    
            for(var index = 0;index < trace.f.length;index++){
                vertex(map(trace.f[index],0,trace.f[trace.f.length-1],0,width),map(trace.s22db[index],displaystate.dbmin,displaystate.dbmax,height,0));
            }
            endShape();
        }
        if(displaystate.show[1]){
            stroke("blue");
            beginShape();    
            for(var index = 0;index < trace.f.length;index++){
                vertex(map(trace.f[index],0,trace.f[trace.f.length-1],0,width),map(trace.s12db[index],displaystate.dbmin,displaystate.dbmax,height,0));
            }
            endShape();
        }
        if(displaystate.show[2]){
            stroke("purple");
            beginShape();    
            for(var index = 0;index < trace.f.length;index++){
                vertex(map(trace.f[index],0,trace.f[trace.f.length-1],0,width),map(trace.s21db[index],displaystate.dbmin,displaystate.dbmax,height,0));
            }
            endShape();
        }
    }
    else{
        for(var fghz = trace.f[0]/1e9;fghz < trace.f[trace.f.length - 1]/1e9;fghz += 1){
            line(map(fghz,trace.f[0]/1e9,trace.f[trace.f.length - 1]/1e9,0,width),0,map(fghz,trace.f[0]/1e9,trace.f[trace.f.length - 1]/1e9,0,width),height);
        }
        fill(0);
        textSize(25);    
        for(var fghz = trace.f[0]/1e9;fghz < trace.f[trace.f.length - 1]/1e9;fghz += 1){
            if(fghz > 0.5){
                text(Math.round(fghz).toString() + " GHz",5+map(fghz,trace.f[0]/1e9,trace.f[trace.f.length - 1]/1e9,0,width),30);            
            }
    
        }
        
        noFill();
        strokeWeight(5);

        if(displaystate.show[0]){

            stroke("red");
            beginShape();    
            for(var index = 0;index < trace.f.length;index++){
                vertex(map(trace.f[index],0,trace.f[trace.f.length-1],0,width),map(trace.s11deg[index],-180,180,height,0));
            }
            endShape();        
        }
        if(displaystate.show[3]){
            stroke("green");
            beginShape();    
            for(var index = 0;index < trace.f.length;index++){
                vertex(map(trace.f[index],0,trace.f[trace.f.length-1],0,width),map(trace.s22deg[index],-180,180,height,0));
            }
            endShape();
        }
        if(displaystate.show[1]){
            stroke("blue");
            beginShape();    
            for(var index = 0;index < trace.f.length;index++){
                vertex(map(trace.f[index],0,trace.f[trace.f.length-1],0,width),map(trace.s12deg[index],-180,180,height,0));
            }
            endShape();
        }
        if(displaystate.show[2]){
            stroke("purple");
            beginShape();    
            for(var index = 0;index < trace.f.length;index++){
                vertex(map(trace.f[index],0,trace.f[trace.f.length-1],0,width),map(trace.s21deg[index],-180,180,height,0));
            }
            endShape();        
        }
    }
    
}


function keyPressed() {
  
//  savejson();
}



direction = '';
function mouseWheel(event) {
  if (event.delta > 0) {
    direction = 'mouse wheel down';

  } else {
    direction = 'mouse wheel up';
  }  
}

function mouseClicked() {
  // Code to run.
}



function savevnacontroljson(){
    var url = "save-file.php";        
    var httpcj = new XMLHttpRequest();
    httpcj.open("POST", url, true);
    httpcj.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    httpcj.send("data="+encodeURIComponent(JSON.stringify(vnacontrol,null,"    "))+"&filename=vna-control.json");//send text to filesaver.php

}


switchstate = {
    "state":"o"
};


function saveswitchstate(){
    var url = "save-file.php";        
    var httpcj = new XMLHttpRequest();
    httpcj.open("POST", url, true);
    httpcj.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    httpcj.send("data="+encodeURIComponent(JSON.stringify(switchstate,null,"    "))+"&filename=switch-state.json");//send text to filesaver.php

}

function savedisplaystate(){
    var url = "save-file.php";        
    var httpcj = new XMLHttpRequest();
    httpcj.open("POST", url, true);
    httpcj.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    httpcj.send("data="+encodeURIComponent(JSON.stringify(displaystate,null,"    "))+"&filename=display-state.json");//send text to filesaver.php

}
</script>
</body>
</html>


    
    
